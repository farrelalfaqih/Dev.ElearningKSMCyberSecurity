<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login | E-Learning Cyber Security</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;700;800&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#309255',
            borderlight: '#D9D9D9',
            softgreen: '#EEFBF3',
          },
          fontFamily: {
            lexend: ['Lexend'],
            mont: ['Montserrat'],
          }
        }
      }
    }
  </script>

  <style>
    body { font-family: 'Montserrat', sans-serif; }
  </style>
</head>
<body class="bg-softgreen/60 min-h-screen flex flex-col">

<!-- NAVBAR -->
<header class="bg-softgreen/60 border-b border-borderlight">
  <div class="max-w-7xl mx-auto px-4 lg:px-8 py-4">
    <div class="flex items-center justify-between">

      <!-- Logo -->
      <div class="flex items-center gap-4">
        <div class="w-14 h-14 rounded-2xl border border-borderlight bg-white flex items-center justify-center">
          <img src="image/LogoHeader.png" class="w-11 h-11 rounded-xl" alt="Logo">
        </div>
        <div class="font-lexend leading-tight">
          <div class="text-gray-800 text-2xl font-bold">Cyber</div>
          <div class="text-primary text-2xl font-medium">Security</div>
        </div>
      </div>

      <!-- Back to Home -->
      <nav class="hidden md:flex items-center gap-4 font-mont text-base">
        <a href="index.html" class="px-4 py-2 rounded-xl hover:bg-softgreen hover:text-primary">
          Home
        </a>
      </nav>

    </div>
  </div>
</header>

<!-- MAIN -->
<main class="flex-1 flex items-center justify-center px-4 py-12">

  <section class="w-full max-w-lg bg-white border border-borderlight rounded-3xl shadow-lg p-8">

    <h1 class="font-lexend text-3xl font-bold mb-2 text-gray-900">Masuk ke Akun</h1>
    <p class="text-gray-500 text-sm mb-6">Akses materi & sertifikat E-Learning Cyber Security.</p>

    <!-- FORM LOGIN -->
    <form id="login-form" class="space-y-5">

      <!-- Email -->
      <div>
        <label class="text-sm font-medium text-gray-700" for="email">Email</label>
        <input
          id="email"
          type="email"
          name="email"
          required
          class="w-full mt-1 px-4 py-2.5 rounded-xl border border-borderlight focus:ring-2 focus:ring-primary focus:outline-none"
          placeholder="email@example.com"
        />
      </div>

      <!-- Password -->
      <div>
        <div class="flex justify-between items-center">
          <label class="text-sm font-medium text-gray-700" for="password">Password</label>
          <a href="forgot-password.html" class="text-xs text-primary font-semibold hover:underline">
            Lupa password?
          </a>
        </div>

        <input
          id="password"
          type="password"
          name="password"
          required
          class="w-full mt-1 px-4 py-2.5 rounded-xl border border-borderlight focus:ring-2 focus:ring-primary focus:outline-none"
          placeholder="Masukkan password"
        />
      </div>

      <!-- Error -->
      <p id="error-text" class="text-sm text-red-600 hidden"></p>

      <!-- BUTTON -->
      <button
        id="login-button"
        type="submit"
        class="w-full bg-primary text-white py-3 rounded-xl font-semibold shadow-md 
               hover:bg-primary/90 transition"
      >
        Masuk
      </button>
    </form>

    <!-- Pemisah -->
    <div class="flex items-center gap-3 my-6">
      <div class="h-px bg-borderlight flex-1"></div>
      <span class="text-xs text-gray-400 uppercase">atau</span>
      <div class="h-px bg-borderlight flex-1"></div>
    </div>

    <!-- Sign Up -->
    <p class="text-center text-sm">
      Belum punya akun?
      <a href="sign-up.html" class="text-primary font-semibold hover:underline">Daftar sekarang</a>
    </p>

  </section>
</main>

<!-- FOOTER -->
<footer class="bg-primary">
  <div class="max-w-7xl mx-auto px-4 py-4">
    <p class="text-center text-white text-sm">
      © 2025 KSM Cyber Security — E-Learning Platform
    </p>
  </div>
</footer>

<!-- SUPABASE LOGIN SCRIPT -->
<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

  const supabaseUrl = "https://zvdyxgmfxgmupezpaaxk.supabase.co";
  const supabaseAnonKey =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2ZHl4Z21meGdtdXBlenBhYXhrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NjM3NzksImV4cCI6MjA4MDIzOTc3OX0.I2JRd_EPXhOhvrV3IPijGKuL8jdkF55dGsPGSMN5wEg";

  const supabase = createClient(supabaseUrl, supabaseAnonKey);

  const form = document.getElementById("login-form");
  const errorText = document.getElementById("error-text");
  const loginButton = document.getElementById("login-button");

  // Kalau sudah login, jangan tampilkan halaman login lagi
  async function checkSession() {
    try {
      const { data: sessionData, error: sessionError } = await supabase.auth.getSession();
      if (sessionError) {
        console.error("Session error:", sessionError.message);
        return;
      }
      if (sessionData?.session) {
        window.location.href = "index.html";
      }
    } catch (err) {
      console.error("Unexpected session error:", err);
    }
  }
  checkSession();

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    errorText.classList.add("hidden");
    errorText.textContent = "";

    const formData = new FormData(form);
    const emailRaw = formData.get("email") ?? "";
    const passwordRaw = formData.get("password") ?? "";

    const email = emailRaw.toString().trim();
    const password = passwordRaw.toString();

    if (!email || !password) {
      errorText.textContent = "Email dan password wajib diisi.";
      errorText.classList.remove("hidden");
      return;
    }

    loginButton.disabled = true;
    loginButton.textContent = "Memproses...";

    try {
      const { error } = await supabase.auth.signInWithPassword({ email, password });

      if (error) {
        errorText.textContent = error.message;
        errorText.classList.remove("hidden");
        loginButton.disabled = false;
        loginButton.textContent = "Masuk";
        return;
      }

      window.location.href = "index.html";
    } catch (err) {
      console.error("Unexpected login error:", err);
      errorText.textContent = "Terjadi kesalahan jaringan. Coba lagi beberapa saat.";
      errorText.classList.remove("hidden");
      loginButton.disabled = false;
      loginButton.textContent = "Masuk";
    }
  });
</script>

</body>
</html>


